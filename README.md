# МЧС Диспетчер - Система диспетчеризации пожарной службы

Система автоматизации работы диспетчеров пожарной службы, направленная на улучшение координации и управления при тушении пожаров.

## Обзор проекта

Проект включает следующие основные функции:
- Авторизация диспетчеров и администраторов
- Интерактивная карта для отметки пожаров
- Автоматическое перенаправление пожаров ближайшим пожарным частям
- Управление уровнями пожаров и требованиями к технике
- Отслеживание движения пожарной техники
- Генерация отчетов по пожарам и работе пожарных частей

## Роли пользователей

1. **Администратор**
   - Управление пользователями (создание аккаунтов диспетчерам)
   - Настройка уровней пожара и требований к технике
   - Управление пожарными частями

2. **Центральный диспетчер**
   - Просмотр карты пожаров
   - Отметка новых пожаров
   - Выбор уровня пожара и автоматическая отправка в ближайшую пожарную часть
   - Генерация отчетов

3. **Диспетчер пожарной части**
   - Просмотр карты с маршрутами до пожаров
   - Получение уведомлений о новых пожарах
   - Управление техникой (отправка машин на пожар)
   - Изменение уровня пожара по результатам разведки
   - Генерация отчетов

## Структура проекта

Проект разделен на две основные части:

### Frontend (папка firedispatch-frontend)
- Технологии: Next.js 15, React 19, TypeScript, TailwindCSS, Zustand
- Компоненты: карты (Leaflet), формы, панели управления
- Маршрутизация: страницы для разных ролей и функций

### Backend (папка firedispatch-backend)
- Технологии: NestJS, Prisma, PostgreSQL
- Модели: пользователи, пожары, пожарные части, техника
- API: аутентификация, управление данными, взаимодействие с картами

## Запуск проекта

### Требования
- Node.js >= 18
- PostgreSQL >= 14
- npm or yarn

### Настройка базы данных
1. Установите PostgreSQL
2. Создайте базу данных для проекта
3. Настройте переменные окружения в `.env` файле backend-части

### Запуск Backend
```bash
cd firedispatch-backend
npm install
npx prisma migrate dev
npm run seed  # Для заполнения базы первоначальными данными
npm run start:dev
```

### Запуск Frontend
```bash
cd firedispatch-frontend
npm install
npm run dev
```

После запуска, приложение будет доступно по адресу: http://localhost:3000

### Тестовые учетные записи
- **Администратор**: username: admin, password: admin123
- **Центральный диспетчер**: username: central, password: central123
- **Диспетчер пожарной части**: username: station1, password: station123

## Детали реализации

### Алгоритм отметки пожара
1. Центральный диспетчер отмечает место пожара на карте
2. Система определяет ближайшую пожарную часть
3. При выборе уровня пожара, система определяет требуемые ресурсы
4. Пожар автоматически перенаправляется диспетчеру ближайшей пожарной части
5. Если у части недостаточно ресурсов, пожар перенаправляется следующей ближайшей части

### Структура базы данных
- Пользователи (users)
- Роли (roles)
- Пожарные части (fire_stations)
- Пожары (fires)
- Пожарные машины (fire_engines)
- Уровни пожаров (fire_levels)
- Требования к технике (fire_level_requirements)
- Отчеты (reports) 

## Последние улучшения

### Оптимизация карты на базе 2GIS API

В ходе разработки мы произвели глубокую оптимизацию работы с картами 2GIS:

1. **Улучшение пользовательского интерфейса**:
   - Обновлены стили маркеров и всплывающих окон для лучшей визуализации
   - Добавлены цветовые индикаторы для различных типов объектов (пожары, пожарные части)
   - Улучшено форматирование и стилизация информационных всплывающих окон

2. **Повышение надежности**:
   - Добавлена детальная обработка ошибок при работе с API карт
   - Реализована асинхронная загрузка SDK с обработкой исключений
   - Корректное освобождение ресурсов карты при размонтировании компонентов
   - Обработка исключительных ситуаций при уничтожении маркеров и карты

3. **Исправления проблем с координатами**:
   - Правильная обработка формата координат ([lng, lat] вместо [lat, lng])
   - Проверка корректности координат перед использованием
   - Корректное преобразование координат между различными форматами

4. **Оптимизация производительности**:
   - Использование кластеризации для эффективного отображения большого количества маркеров
   - Оптимизация обновления маркеров при изменении данных
   - Отложенная инициализация маркеров для предотвращения проблем при загрузке

5. **Улучшения для разработчиков**:
   - Подробное логирование для отладки
   - Улучшенная обратная связь при ошибках API
   - Типизированные объекты для лучшей поддержки IDE

Все эти изменения значительно улучшили пользовательский опыт и стабильность работы системы. 